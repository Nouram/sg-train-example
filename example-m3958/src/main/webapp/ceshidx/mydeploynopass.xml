<?xml version="1.0" encoding="UTF-8"?>

<!--最小单位是task，target是task的集合 mvn install:install-file -DgroupId=net.sf.json-lib -DartifactId=json-lib -Dversion=2.4 -Dfile=e:/json-lib-2.4-jdk15.jar -Dpackaging=jar -DgeneratePom=true -->
<project name="CopyGwtWar" basedir="../" default="deploy">
	<property name="srcwar.dir" value="${basedir}"></property>
	<property name="dstwar.dir" value="E:/deploywar"></property>

	<target name="deletedeplaywar" description="删除deploywar目录">
		<delete includeemptydirs="true">
			<fileset dir="${dstwar.dir}" includes="**/*" />
		</delete>
	</target>

	<!-- 我要完成复制war这个target -->
	<target name="copywar" depends="deletedeplaywar" description="删除svn和jar，然后复制">
		<!-- 这是一个task -->
		<copy todir="${dstwar.dir}">
			<fileset dir="${srcwar.dir}">
				<exclude name="**/*.svn" />
				<exclude name="**/*.jar" />
				<exclude name="mydeploy.xml" />
				<exclude name="**/gwt-servlet.jar" />
				<exclude name="**/*.jdbc" />
				<exclude name="jasperoutput/**" />
				<exclude name="VAADIN/**" />
			</fileset>
		</copy>
	</target>

	<target name="compress" depends="copywar" description="压缩成rar文件">
		<delete file="${dstwar.dir}/firstgwt.tar">
		</delete>
		<delete file="${dstwar.dir}/firstgwt.tar.gz">
		</delete>

		<tar destfile="${dstwar.dir}/firstgwt.tar">
			<fileset dir="${dstwar.dir}">
			</fileset>
		</tar>
		<gzip destfile="${dstwar.dir}/firstgwt.tar.gz" src="${dstwar.dir}/firstgwt.tar" />
	</target>

	<target name="toServer" depends="compress" description="送到服务器">
		<ftp password="" server="" userid="" action="put">
			<fileset file="${dstwar.dir}/firstgwt.tar.gz"></fileset>
		</ftp>
	</target>

	<target name="deploy" depends="toServer">
		<sshexec trust="true" password="" host="" username=""
			command="mv /home/jianglibo/firstgwt.tar.gz /usr/local/apache-tomcat-6.0/lgbapps/ROOT;cd /usr/local/apache-tomcat-6.0/lgbapps/ROOT;tar -zxvf firstgwt.tar.gz;cp /usr/home/jianglibo/deploy/jbpm4lib/* /usr/local/apache-tomcat-6.0/lgbapps/ROOT/WEB-INF/lib; cp /usr/local/apache-tomcat-6.0/lib/log4j.properties /usr/local/apache-tomcat-6.0/lgbapps/ROOT/WEB-INF/classes/" />
	</target>

</project>